<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Staff Profile | Inventory System</title>
    <link rel="stylesheet" href="../Css/style.css" />
    <link rel="stylesheet" href="../Css/staff-styles.css" />
</head>
<body>
    <div class="dashboard-layout">
        <aside class="dashboard-sidebar">
            <h1>IMS</h1>
            <ul class="nav-links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="low-stock.html">Low Stock</a></li>
                <li><a href="sales.html">Sales</a></li>
                <li><a href="staff-profile.html" id="profile-link" class="active">Profile</a></li>
            </ul>
            <div class="auth-links">
                <a href="login.html">Login</a>
                <a href="register.html">Register</a>
            </div>
            <a id="logout-btn" href="#">Logout</a>
        </aside>
        <main class="dashboard-content">
            <h2 id="profile-title">Staff Profile</h2>
            
            <div class="profile-info">
                <div class="profile-header">
                    <div class="profile-picture-container">
                        <div class="profile-picture" id="profile-picture">
                            <img src="../images/default-avatar.png" alt="Profile Picture" id="profile-image">
                        </div>
                        <div class="profile-picture-upload">
                            <label for="profile-upload" class="upload-btn">Change Picture</label>
                            <input type="file" id="profile-upload" accept="image/*">
                        </div>
                    </div>
                    
                    <div id="user-info">
                        <h3>Staff Information</h3>
                        <p><strong>Name:</strong> <span id="user-name">Loading...</span></p>
                        <p><strong>ID:</strong> <span id="user-id">Loading...</span></p>
                        <p><strong>Role:</strong> <span id="user-role">Staff</span></p>
                    </div>
                </div>
                
                <div class="personal-info-form">
                    <h3>Personal Information</h3>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" placeholder="Your full name">
                        </div>
                        
                        <div class="form-group">
                            <label for="staff-id">Staff ID</label>
                            <input type="text" id="staff-id" name="staffId" placeholder="Your staff ID">
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Address</label>
                            <textarea id="address" name="address" placeholder="Your address"></textarea>
                        </div>
                        
                        <button type="submit" id="save-profile">Save Changes</button>
                    </form>
                </div>
                
                <div class="document-preview">
                    <div class="document-actions">
                        <button class="print-btn" id="print-document">
                            <span>Print Document</span>
                        </button>
                    </div>
                    
                    <div class="document-content staff-document">
                        <div class="document-header">
                            <h2>Staff Information Document</h2>
                            <div class="document-date" id="document-date">Date: <span id="current-date"></span></div>
                        </div>
                        
                        <div class="document-body">
                            <div class="staff-profile-section">
                                <p><strong>Name:</strong> <span id="doc-name"></span></p>
                                <p><strong>Staff ID:</strong> <span id="doc-id"></span></p>
                                <p><strong>Address:</strong> <span id="doc-address"></span></p>
                            </div>
                        </div>
                        
                        <div class="document-footer">
                            <p>This document was generated by the Inventory Management System.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script type="module">
        import { checkAuth } from '../js/auth.js';
        
        // Check if user is authenticated
        if (!checkAuth()) {
            // If not authenticated, checkAuth will redirect to login
            // No need to do anything here
        } else {
            // User is authenticated, proceed with profile setup
            setupProfile();
        }
        
        function setupProfile() {
            // Get user data from localStorage
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            const userRole = localStorage.getItem('userRole');
            
            // Verify this is a staff profile
            if (userRole !== 'Staff') {
                // Redirect admin to admin profile
                window.location.href = 'admin-profile.html';
                return;
            }
            
            // Update profile information
            document.getElementById('user-name').textContent = userData.name || 'Not set';
            document.getElementById('user-id').textContent = userData.staffId || 'Not set';
            
            // Fill form fields
            document.getElementById('name').value = userData.name || '';
            document.getElementById('staff-id').value = userData.staffId || '';
            document.getElementById('address').value = userData.address || '';
            
            // Update document preview
            updateDocumentPreview();
            
            // Set up profile picture
            if (userData.profilePicture) {
                document.getElementById('profile-image').src = userData.profilePicture;
            }
            
            // Set up event listeners
            document.getElementById('profile-form').addEventListener('submit', saveProfile);
            document.getElementById('profile-upload').addEventListener('change', handleProfilePictureUpload);
            document.getElementById('print-document').addEventListener('click', printDocument);
            
            // Set current date in document
            const today = new Date();
            document.getElementById('current-date').textContent = today.toLocaleDateString();
        }
        
        function saveProfile(event) {
            event.preventDefault();
            
            // Get form data
            const name = document.getElementById('name').value;
            const staffId = document.getElementById('staff-id').value;
            const address = document.getElementById('address').value;
            
            // Get existing user data
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            // Update user data
            userData.name = name;
            userData.staffId = staffId;
            userData.address = address;
            
            // Save updated user data
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // Update profile display
            document.getElementById('user-name').textContent = name;
            document.getElementById('user-id').textContent = staffId;
            
            // Update document preview
            updateDocumentPreview();
            
            alert('Profile updated successfully!');
        }
        
        function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update profile picture
                    document.getElementById('profile-image').src = e.target.result;
                    
                    // Save profile picture to localStorage
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    userData.profilePicture = e.target.result;
                    localStorage.setItem('userData', JSON.stringify(userData));
                };
                reader.readAsDataURL(file);
            }
        }
        
        function updateDocumentPreview() {
            // Get form data
            const name = document.getElementById('name').value;
            const staffId = document.getElementById('staff-id').value;
            const address = document.getElementById('address').value;
            
            // Update document preview
            document.getElementById('doc-name').textContent = name || 'Not set';
            document.getElementById('doc-id').textContent = staffId || 'Not set';
            document.getElementById('doc-address').textContent = address || 'Not set';
        }
        
        function printDocument() {
            window.print();
        }
    </script>
</body>
</html>